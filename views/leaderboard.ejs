<!DOCTYPE html>
<html lang="en">
<head>
   <link rel="stylesheet" href="/file.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Christmas</title>
    <!-- CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

<title>Virtual Christmas Leaderboard!</title>  
<meta name="description" content= "View the richest users in Virtual Christmas!" />
<meta name="robots" content= "index, follow">
<!-- jQuery and JS bundle w/ Popper.js -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="/">Virtual Christmas!</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Home<span class="sr-only">(current)</span></a>
            </li>
           
              <% if (session) { %>
                <li class="nav-item">
                    <a class="nav-link" href="/play">Play</a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="/inventory">Inventory</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/sell">Sell</a>
              </li>
      <% } else { %>
        <li class="nav-item">
              <a class="nav-link" href="/login">Login</a>
            </li>
              <li class="nav-item">
              <a class="nav-link" href="/create">Sign Up</a>
            </li>
              <% } %>
                <li class="nav-item active">
              <a class="nav-link" href="/leaderboard">Leaderboard</a>
            </li>
                        <li class="nav-item">
                <a class="nav-link" href="/chat">GameChat</a>
              </li>
          </ul>
           <% if (session) { %>
           <ul class="navbar-nav">
              <li class="nav-item dropdown pull-right">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <%=uname%>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="/logout">Log out</a>
              </div>
            </li>
                  <% } %>
      </ul>
        </div>
      </nav>
  <br/>
  <center><h1>Virtual Christmas Leaderboard!</h1>
  <br/><h4>Realtime Update</h4><br/><h5 id="info"></h4></center>
  <div id="leaderboard">
    <center><b>Please wait...</b></center>
  </div>
  <script>
    var leaderboarde = document.getElementById("leaderboard")
    var info = document.getElementById("info")
    setInterval(()=> {
         function numberWithCommas(x) {
        return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }
 
     fetch("/api/leaderboard").then(r=>r.json()).then(json=>{
      var leaderboard = json.leaderboard.slice(0,10);
       i=1;
       text = ""
       <% if(yeet) { %>
       for (user in leaderboard) {
         text += `<p>#${i}- <a class="a" style="color: white" href="${window.location.origin}/inventory/${leaderboard[user]._id}">${leaderboard[user]._id}</a>- $${numberWithCommas(leaderboard[user].bal)}</p>`
         i+=1
       }
       <% } else { %> 
             for (user in leaderboard) {
                text += `<p>#${i}- ${leaderboard[user]._id}- $${numberWithCommas(leaderboard[user].bal)}</p>`
         i+=1
         }
       <%} %>
       leaderboarde.innerHTML = `<center><div class="leaderboardbg"><br/>${text}</div></center>`
       info.innerHTML = `Showing top 10 users from ${json.leaderboard.length} total users!`
 })
         }, 1000)
  </script>
</body>
</html>